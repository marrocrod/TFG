{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- Columna para la lista de eventos -->
    <div class="col-md-2 pr-0">
        <h4 class="text-center">Eventos en los próximos 30 días</h4>    
        <ul class="list-group">
            {% for event in upcoming_events %}
                <li class="list-group-item">
                    <span class="event-color-dot" style="background-color: {{ event.color }};"></span>
                    <strong>{{ event.title }}</strong><br>
                    <span>{{ event.start_time|date:"j F" }}</span><br>
                    <span>{{ event.start_time|date:"H:i" }} - {{ event.end_time|date:"H:i" }}</span>
                </li>
            {% empty %}
                <li class="list-group-item">No hay eventos próximos</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Columna para el calendario -->
    <div class="col-md-10">
        <h2>Calendario</h2>
        <div id="calendar"></div>
    </div>
</div>

<!-- Ventana Modal -->
<div id="eventModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Crear Evento</h2>
        <form id="eventForm">
            <label for="title">Título del Evento:</label>
            <input type="text" id="title" name="title" required>

            <label for="start">Fecha de Inicio:</label>
            <input type="datetime-local" id="start" name="start" required>

            <label for="end">Fecha de Fin:</label>
            <input type="datetime-local" id="end" name="end" required>

            <button type="submit">Guardar Evento</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            events: '/api/calendar-events/',  // Asegúrate de que esta URL esté correctamente configurada
            eventContent: function(arg) {
                // Crear el punto de color
                let dotEl = document.createElement('span');
                dotEl.className = "fc-event-dot";
                dotEl.style.backgroundColor = arg.event.backgroundColor;
    
                // Crear el nombre del evento
                let titleEl = document.createElement('span');
                titleEl.className = "fc-event-title";
                titleEl.innerText = ` ${arg.event.title}`;
    
                // Agrupar el punto de color y el nombre del evento en una línea
                let titleContainerEl = document.createElement('div');
                titleContainerEl.className = 'fc-event-title-container';
                titleContainerEl.append(dotEl, titleEl);
    
                // Crear el tramo horario debajo del nombre
                let timeEl = document.createElement('div');
                timeEl.className = "fc-event-time";
                timeEl.innerText = `${arg.event.startStr.slice(11, 16)} - ${arg.event.endStr.slice(11, 16)}`;  // Extraer las horas y minutos
    
                // Agrupar todo (nombre del evento y tramo horario)
                let eventContentEl = document.createElement('div');
                eventContentEl.append(titleContainerEl, timeEl);
    
                return { domNodes: [eventContentEl] };
            },
            dateClick: function(info) {
                window.location.href = `/calendar/day/${info.dateStr}/`;
            },
            eventClick: function(info) {
                window.location.href = `/calendar/edit/${info.event.id}/`;
            }
        });
        calendar.render();
    });

    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('eventForm');
        var startTimeInput = document.getElementById('start');
        var endTimeInput = document.getElementById('end');
    
        form.addEventListener('submit', function(event) {
            var startTime = new Date(startTimeInput.value);
            var endTime = new Date(endTimeInput.value);
    
            if (endTime <= startTime) {
                event.preventDefault();
                alert("La hora de finalización debe ser posterior a la hora de inicio.");
            }
        });
    });
    
    
</script>



<!-- Estilos para la ventana modal -->
<style>
    /* Estilo para los puntos de color en la lista de eventos */
    .event-color-dot {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
        vertical-align: middle;
    }
    
    /* Asegura que todos los eventos en el calendario se muestren con un punto */
    .fc-daygrid-event-dot {
        width: 10px; /* Tamaño del punto de color */
        height: 10px;
        border-radius: 50%;
        margin-right: 5px;
        display: inline-block;
        vertical-align: middle;
    }

    .fc-event-container {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .fc-daygrid-event {
        max-width: 100%; /* Asegura que el evento no desborde su contenedor */
        overflow: hidden; /* Oculta cualquier desbordamiento de contenido */
        white-space: nowrap; /* Mantiene el contenido en una sola línea */
        text-overflow: ellipsis; /* Muestra puntos suspensivos si el contenido es demasiado largo */
        display: block; /* Asegura que se comporte como un bloque */
        font-size: 0.85em; /* Ajuste de tamaño para mejor visualización */
        color: black; /* Asegura que todo el texto del evento tenga el mismo color */
    }
    
    .fc-event-title-container {
        display: flex;
        align-items: center;
        max-width: 100%;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
    }
    
    .fc-event-title {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: black;  /* Mantiene el color del texto */
    }
    
    /* Asegura que el evento no tenga fondo de color extendido */
    .fc-event {
        background-color: transparent !important;
        border: none !important;
    }
    
    /* Punto de color para los eventos */
    .fc-event-dot {
        width: 10px; /* Tamaño del punto de color */
        height: 10px;
        border-radius: 50%;
        margin-right: 5px;
        display: inline-block;
        vertical-align: middle;
    }

    /.fc-event-time {
        font-size: 0.85em;
        color: #666;
        margin-top: 2px;  /* Un pequeño margen superior para separar del título */
        display: block;  /* Asegura que la hora esté en una nueva línea */
    }

    .fc-event-title-container,
    .fc-event-time {
        display: block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>
{% endblock %}
